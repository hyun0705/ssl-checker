<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>SSL ì¸ì¦ì„œ ì²´ì»¤</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: "Segoe UI", sans-serif;
			max-width: 600px;
			margin: 50px auto;
			padding: 20px;
			background: #e8eaf6;
			min-height: 100vh;
		}

		.container {
			background: #fafbff;
			padding: 30px;
			border-radius: 15px;
			box-shadow: 0 4px 20px rgba(102, 126, 234, 0.1);
			border: 1px solid #e3e8f7;
		}

		h1 {
			color: #3f4254;
			text-align: center;
			margin-bottom: 30px;
		}

		.input-group {
			display: flex;
			gap: 10px;
			margin-bottom: 20px;
		}

		input {
			flex: 1;
			padding: 15px;
			font-size: 16px;
			border: 2px solid #e0e0e0;
			border-radius: 8px;
		}

		input:hover {
			border-color: #667eea;
			transition: all 0.2s ease;
		}

		input:focus {
			outline: none;
			border-color: #667eea;
		}

		#btn {
			padding: 15px 30px;
			font-size: 16px;
			font-weight: bold;
			background: #667eea;
			color: white;
			border: none;
			border-radius: 8px;
			cursor: pointer;
			transition: all 0.2s ease;
		}

		#btn:disabled {
			opacity: 0.6;
			cursor: not-allowed;
		}

		#btn:hover {
			background: #5568d3;
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
		}

		#result {
			margin-top: 20px;
			padding: 20px;
			background: #f0f2ff;
			border-radius: 8px;
			line-height: 1.8;
			display: block;
			border: 1px solid #e3e8f7;
		}

		.result-item {
			padding: 8px 0;
			border-bottom: 1px solid #e0e0e0;
		}

		.result-item:last-child {
			border-bottom: none;
		}

		.label {
			font-weight: bold;
			color: #5f6368;
		}

		.value {
			color: #3f4254;
			margin-left: 10px;
		}

		.days {
			display: inline-block;
			padding: 4px 12px;
			border-radius: 15px;
			font-weight: bold;
		}

		.days.safe {
			background: #d4edda;
			color: #155724;
		}

		.days.warning {
			background: #fff3cd;
			color: #856404;
		}

		.days.danger {
			background: #f8d7da;
			color: #721c24;
		}

		/* íˆìŠ¤í† ë¦¬ ìŠ¤íƒ€ì¼ */
		.history-item {
			padding: 10px 30px 10px 10px;
			margin-bottom: 8px;
			background: #fafbff;
			border: 1px solid #e3e8f7;
			border-radius: 6px;
			cursor: pointer;
			transition: all 0.2s ease;
			position: relative;
		}

		.history-item:hover {
			background: #fafbff;
			border-color: #e3e8f7;
			box-shadow: none;
		}

		.history-item:last-child {
			margin-bottom: 0;
		}

		.delete-btn {
			position: absolute;
			right: 8px;
			top: 50%;
			transform: translateY(-50%);
			background: none;
			color: #999;
			border: none;
			width: 20px;
			height: 20px;
			font-size: 16px;
			line-height: 1;
			cursor: pointer;
			padding: 0;
			transition: transform 0.15s ease, color 0.15s ease;
		}

		.delete-btn:hover {
			transform: translateY(-50%) scale(1.15);
			color: #555;
		}

		.history-domain {
			font-weight: bold;
			color: #3f4254;
			font-size: 14px;
		}

		.history-meta {
			font-size: 12px;
			color: #7e8299;
			margin-top: 5px;
		}

		.history-status {
			display: inline-block;
			padding: 2px 8px;
			border-radius: 10px;
			font-size: 11px;
			margin-left: 5px;
		}

		.history-status.safe {
			background: #d4edda;
			color: #155724;
		}

		.history-status.warning {
			background: #fff3cd;
			color: #856404;
		}

		.history-status.danger {
			background: #f8d7da;
			color: #721c24;
		}
	</style>
</head>

<body>
	<div class="container">
		<h1>ğŸ”’ SSL ì¸ì¦ì„œ ì²´ì»¤</h1>

		<div class="input-group">
			<input id="domain" placeholder="ì˜ˆ: www.google.com, naver.com" />
			<button id="btn">í™•ì¸</button>
		</div>

		<!-- íˆìŠ¤í† ë¦¬ ì„¹ì…˜ -->
		<div id="history-section" style="display: none; margin-bottom: 20px;">
			<h3 style="font-size: 14px; color: #666; margin-bottom: 10px;">ğŸ“œ ìµœê·¼ ì¡°íšŒ ë‚´ì—­</h3>
			<div id="history-list"
				style="background: #f8f9fa; padding: 10px; border-radius: 8px; max-height: 200px; overflow-y: auto;">
				<!-- íˆìŠ¤í† ë¦¬ í•­ëª©ë“¤ -->
			</div>
		</div>

		<div id="result">
			<div style="text-align: center; padding: 40px; color: #999;">
				<div style="font-size: 48px;">ğŸ”</div>
				<p>ë„ë©”ì¸ì„ ì…ë ¥í•˜ê³  í™•ì¸ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</p>
				<small>ì˜ˆ: www.google.com, naver.com</small>
			</div>
		</div>
	</div>

	<script>
		// íˆìŠ¤í† ë¦¬ ê´€ë¦¬ í•¨ìˆ˜ë“¤
		function getHistory() {
			const history = localStorage.getItem('ssl-history');
			return history ? JSON.parse(history) : [];
		}

		function saveHistory(domain, status, daysLeft) {
			const history = getHistory();

			// ì¤‘ë³µ ì œê±° (ê°™ì€ ë„ë©”ì¸ì€ ìµœì‹  ê²ƒë§Œ)
			const filtered = history.filter(item => item.domain !== domain);

			// ìƒˆ í•­ëª© ì¶”ê°€ (ë§¨ ì•ì—)
			filtered.unshift({
				domain: domain,
				status: status,
				daysLeft: daysLeft,
				time: new Date().toISOString()
			});

			// ìµœëŒ€ 5ê°œë§Œ ì €ì¥
			const limited = filtered.slice(0, 5);
			localStorage.setItem('ssl-history', JSON.stringify(limited));

			renderHistory();
		}

		function deleteHistoryItem(domain, event) {
			event.stopPropagation(); // í´ë¦­ ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€

			const history = getHistory();
			const filtered = history.filter(item => item.domain !== domain);
			localStorage.setItem('ssl-history', JSON.stringify(filtered));
			renderHistory();
		}

		function getTimeAgo(timestamp) {
			const now = new Date();
			const past = new Date(timestamp);
			const diffMs = now - past;
			const diffMins = Math.floor(diffMs / 60000);

			if (diffMins < 1) return 'ë°©ê¸ˆ ì „';
			if (diffMins < 60) return `${diffMins}ë¶„ ì „`;

			const diffHours = Math.floor(diffMins / 60);
			if (diffHours < 24) return `${diffHours}ì‹œê°„ ì „`;

			const diffDays = Math.floor(diffHours / 24);
			return `${diffDays}ì¼ ì „`;
		}

		function renderHistory() {
			const history = getHistory();
			const section = document.getElementById('history-section');
			const list = document.getElementById('history-list');

			if (history.length === 0) {
				section.style.display = 'none';
				return;
			}

			section.style.display = 'block';

			list.innerHTML = history.map(item => {
				const statusClass = item.daysLeft < 30 ? 'danger'
					: item.daysLeft < 90 ? 'warning'
						: 'safe';

				return `
					<div class="history-item" onclick="document.getElementById('domain').value='${item.domain}'; check();">
						<div class="history-domain">
							ğŸŒ ${item.domain}
							<span class="history-status ${statusClass}">${item.status}</span>
						</div>
						<div class="history-meta">
							â° ${item.daysLeft}ì¼ ë‚¨ìŒ Â· ${getTimeAgo(item.time)}
						</div>
						<button class="delete-btn" onclick="deleteHistoryItem('${item.domain}', event)">âœ•</button>
					</div>
				`;
			}).join('');
		}

		// í˜ì´ì§€ ë¡œë“œ ì‹œ íˆìŠ¤í† ë¦¬ í‘œì‹œ
		document.addEventListener('DOMContentLoaded', () => {
			renderHistory();
		});

		async function check() {
			const domain = document.getElementById('domain').value.trim();

			if (!domain) {
				alert('ë„ë©”ì¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
				return;
			}

			// ë„ë©”ì¸ í˜•ì‹ ê²€ì¦
			const domainPattern = /^[a-zA-Z0-9][a-zA-Z0-9-_.]*\.[a-zA-Z]{2,}$/;
			const cleanDomain = domain.split('/')[0].split(':')[0];
			if (!domainPattern.test(cleanDomain)) {
				alert('ì˜¬ë°”ë¥¸ ë„ë©”ì¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤!');
				return;
			}

			// ë¡œë”© í‘œì‹œ
			const btn = document.getElementById('btn');
			btn.disabled = true;
			btn.textContent = 'ì¡°íšŒ ì¤‘...';

			document.getElementById('result').innerHTML = `
				<div style="text-align: center; padding: 30px;">
					<div style="font-size: 40px;">â³</div>
					<div>SSL ì •ë³´ë¥¼ ì¡°íšŒí•˜ëŠ” ì¤‘...</div>
				</div>
			`;

			try {
				// í™˜ê²½ì— ë”°ë¼ API URL ìë™ ë³€ê²½
				const API_URL = window.location.hostname === 'localhost'
					? 'http://localhost:3000'
					: window.location.origin;

				const response = await fetch(`${API_URL}/api/check`, {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ domain: domain })
				});

				if (!response.ok) {
					throw new Error('ì„œë²„ ì‘ë‹µ ì‹¤íŒ¨');
				}

				const data = await response.json();

				if (data.error) {
					throw new Error(data.error);
				}

				let daysClass = 'safe';
				if (data.daysLeft < 30) daysClass = 'danger';
				else if (data.daysLeft < 90) daysClass = 'warning';

				// íˆìŠ¤í† ë¦¬ì— ì €ì¥
				saveHistory(data.domain, data.status, data.daysLeft);

				document.getElementById('result').innerHTML = `
					<!-- 1. í•µì‹¬ ì •ë³´ -->
					<div class="result-item">
						<span class="label">ğŸŒ ë„ë©”ì¸:</span>
						<span class="value">${data.domain}</span>
					</div>
					
					<div class="result-item">
						<span class="label">ğŸ“Š ìƒíƒœ:</span>
						<span class="status ${data.status}">${data.status}</span>
					</div>

					<div class="result-item">
						<span class="label">â° ë‚¨ì€ì¼ìˆ˜:</span>
						<span class="days ${daysClass}">${data.daysLeft}ì¼</span>
					</div>
					
					<!-- 2. ë‚ ì§œ ì •ë³´ -->
					<div class="result-item">
						<span class="label">ğŸ“… ë°œê¸‰ì¼:</span>
						<span class="value">${data.validFrom}</span>
					</div>
					
					<div class="result-item">
						<span class="label">ğŸ“… ë§Œë£Œì¼:</span>
						<span class="value">${data.validTo}</span>
					</div>
					
					<!-- 3. ë°œê¸‰ ì •ë³´ -->
					<div class="result-item">
						<span class="label">ğŸ¢ ë°œê¸‰ê¸°ê´€:</span>
						<span class="value">${data.issuer}</span>
					</div>
					
					<div class="result-item">
						<span class="label">ğŸ” ì„œëª… ì•Œê³ ë¦¬ì¦˜:</span>
						<span class="value">${data.signatureAlgorithm}</span>
					</div>
					
					<!-- 4. ê¸°ìˆ  ì •ë³´ -->
					${data.alternativeNames && data.alternativeNames.length > 0 ? `
					<div class="result-item">
						<span class="label">ğŸ“‹ ì»¤ë²„ ë„ë©”ì¸:</span>
						<span class="value" style="display: block; line-height: 1.6;">
							${data.alternativeNames.slice(0, 10).join('<br>')}
							${data.alternativeNames.length > 10 ? '<br>...' : ''}
						</span>
					</div>
					` : ''}
					
					<div class="result-item">
						<span class="label">ğŸ“‹ ë²„ì „:</span>
						<span class="value">X.509 v${data.version}</span>
					</div>
					
					<div class="result-item">
						<span class="label">ğŸ”‘ Fingerprint:</span>
						<span class="value" style="font-size: 11px; word-break: break-all;">
							${data.fingerprint}
						</span>
					</div>
				`;

			} catch (error) {
				document.getElementById('result').innerHTML = `
					<div style="color: #dc3545; padding: 20px; text-align: center; background: #f8d7da; border-radius: 8px;">
						âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}
						<br><small style="color: #721c24; margin-top: 10px; display: block;">ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ê±°ë‚˜ ë„ë©”ì¸ì„ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.</small>
					</div>
				`;
			} finally {
				// ë²„íŠ¼ ë³µêµ¬
				btn.disabled = false;
				btn.textContent = 'í™•ì¸';
			}
		}

		document.getElementById('btn').addEventListener('click', function () {
			check();
		});

		document.getElementById('domain').addEventListener('keypress', function (e) {
			if (e.key === 'Enter') {
				check();
			}
		});
	</script>
</body>

</html>